<!DOCTYPE html>
<html lang="en" ng-app="tournament">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/index.css">

    <script src='/js/jquery-1.12.2.min.js'></script>
    <script src="/js/jquery.bracket.min.js"></script>
    <link rel="stylesheet" href="/css/jquery.bracket.min.css">
</head>

<body>
<% include ../partials/header %>


    <h2 id="title" style="color: white; float: left; margin-left: 20px"></h2>
    <div id="tournament-container" style="clear: left">
    <script type="text/javascript">

        var tournament = {teams: [], results: []};
//        var previous = {teams: [], results: []};

        $.get('/api/v1/tournaments/' + window.location.href.split('/')[4], function(data){

            document.getElementById('title').innerHTML = data.data[0].title;

        });

        $.get('/api/v1/tournaments/' + window.location.href.split('/')[4] + "/matches", function(data) {
//            alert(tournament.teams);
            for (var i = 0; i < data.data.length; i ++) {
                tournament.teams.push([data.data[i].username1, data.data[i].username2]);
                tournament.results.push([null, null]);
            }
            var previous = tournament;

            $.get('/api/v1/tournaments/' + window.location.href.split('/')[4], function(data){

                document.getElementById('title').innerHTML = data.data[0].title;
                $(function () {
                    $('div#save .demo').bracket({
                        init: tournament, /* data to initialize the bracket with */
                        save: saveFn,
                        userData: ' ',
                        onMatchClick: null,
                        onMatchHover: null,
                        decorator: null,
                        skipSecondaryFinal: false,
                        skipGrandFinalComeback: false,
                        dir: 'lr'
                    });
                });

                function saveFn(data, userData) {
                    var json = JSON.stringify(data);
//                    alert(json);
                    $('#saveOutput').text('POST ' + userData + ' ' + json);
                    var val = whatsChanged(data, previous);
                    previous = data;
//                    $.ajax('/api/v1/tournament/'+window.location.href.split('/')[4] + '/' + userData, {
//                        contentType: 'application/json',
//                        dataType: 'json',
//                        type: 'post',
//                        data: json
//                    });
                }

            });

            function whatsChanged(data, previous) {

                var update = [];
                for (var i = 0; i < data.results.length; i++){
                    alert(data.results[i]);
                    for (var j = 0; j < data.results[i].length; j++){
//                        console.log(data.results[i][j][0][0]);
                        for (var k = 0; k < data.results[i][j].length; k++){
                            console.log(data.results[i][j][k][0]);
                        }
                    }
                }
            }

        });


    </script>
    <div id="save" style="margin: 20px 200px">
    <div class="demo"></div>
    </div>
    </div>
<% include ../partials/footer %>
</body>
</html>


<!--<svg ng-repeat="name in names track by $index">-->
<!--<g ng-if="{{$index % 2 === 0}}">-->
<!--<rect x="0" y="{{$index * 30}}" width="100" height="20" ></rect>-->
<!--<text x="0" y="{{$index * 30}}" font-family="Verdana" font-size="16" fill="white" > {{ name }}</text>-->
<!--</g>-->
<!--<g ng-if="{{$index % 2 === 1}}">-->
<!--<rect x="0" y="{{($index - 1) * 30 + 20}}" width="100" height="20" ></rect>-->
<!--<text x="0" y="{{($index - 1) * 30 + 20}}" font-family="Verdana" font-size="16" fill="white" > {{ name }} </text>-->
<!--</g>-->
<!--</svg>-->